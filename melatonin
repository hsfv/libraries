local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local camera = workspace.CurrentCamera
local TweenService = game:GetService("TweenService")

local snowEffectCreated = false
local snowBackgroundGui, snowFlakesGui, snowflakes, snowConnection

local Settings = {
    DarkBackground = true,
    SnowEffect = true,
    ThemeColor = Color3.fromRGB(90, 30, 180),
    ToggleKey = Enum.KeyCode.RightControl
}

local function createSnowGuis()
    if snowEffectCreated then return end
    
    snowBackgroundGui = Instance.new("ScreenGui")
    snowBackgroundGui.Name = "SnowBackground"
    snowBackgroundGui.DisplayOrder = 1
    snowBackgroundGui.IgnoreGuiInset = true
    snowBackgroundGui.ResetOnSpawn = false
    snowBackgroundGui.Enabled = false
    snowBackgroundGui.Parent = CoreGui
    
    local snowBackground = Instance.new("Frame")
    snowBackground.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    snowBackground.BackgroundTransparency = 0.3
    snowBackground.AnchorPoint = Vector2.new(0.5, 0.5)
    snowBackground.Position = UDim2.new(0.5, 0, 0.5, 0)
    snowBackground.Size = UDim2.new(1, 0, 1, 0)
    snowBackground.Parent = snowBackgroundGui
    
    snowFlakesGui = Instance.new("ScreenGui")
    snowFlakesGui.Name = "SnowFlakes"
    snowFlakesGui.DisplayOrder = 2
    snowFlakesGui.IgnoreGuiInset = true
    snowFlakesGui.ResetOnSpawn = false
    snowFlakesGui.Enabled = false
    snowFlakesGui.Parent = CoreGui
    
    local SNOWFLAKE_COUNT = 60
    local MIN_SPEED = 30
    local MAX_SPEED = 80
    local MIN_SIZE = 4
    local MAX_SIZE = 8
    
    snowflakes = {}
    
    for i = 1, SNOWFLAKE_COUNT do
        local flake = Instance.new("Frame")
        flake.BackgroundColor3 = Color3.new(1, 1, 1)
        flake.BackgroundTransparency = math.random(10, 30) / 100
        flake.BorderSizePixel = 0
        flake.ZIndex = 10
        
        local size = math.random(MIN_SIZE, MAX_SIZE)
        flake.Size = UDim2.fromOffset(size, size)
        flake.Position = UDim2.fromScale(math.random(), math.random())
        flake.Parent = snowFlakesGui
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(1, 0)
        corner.Parent = flake
        
        table.insert(snowflakes, {
            frame = flake,
            speed = math.random(MIN_SPEED, MAX_SPEED),
            drift = math.random(-20, 20) / 10
        })
    end
    
    snowEffectCreated = true
end

local scrennnnnnngui = Instance.new("ScreenGui")
scrennnnnnngui.Name = "MainUI"
scrennnnnnngui.DisplayOrder = 3
scrennnnnnngui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
scrennnnnnngui.ResetOnSpawn = false
scrennnnnnngui.Enabled = false
scrennnnnnngui.Parent = CoreGui

local Main = Instance.new("Frame")
Main.AnchorPoint = Vector2.new(0.5, 0.5)
Main.Name = "Main"
Main.Position = UDim2.new(0.5, 0, 0.5, 0)
Main.BorderColor3 = Color3.fromRGB(0, 0, 0)
Main.Size = UDim2.new(0, 500, 0, 400)
Main.BorderSizePixel = 0
Main.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Main.Parent = scrennnnnnngui

local UIAspectRatioConstraint = Instance.new("UIAspectRatioConstraint")
UIAspectRatioConstraint.AspectRatio = 1.25
UIAspectRatioConstraint.Parent = Main

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 6)
UICorner.Parent = Main

local UIStroke = Instance.new("UIStroke")
UIStroke.Thickness = 1.5
UIStroke.Color = Color3.fromRGB(30, 30, 30)
UIStroke.Parent = Main

local Header = Instance.new("Frame")
Header.BackgroundTransparency = 1
Header.Name = "Header"
Header.BorderColor3 = Color3.fromRGB(0, 0, 0)
Header.Size = UDim2.new(1, 0, 0.064, 0)
Header.BorderSizePixel = 0
Header.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Header.Parent = Main

local HeaderText = Instance.new("TextLabel")
HeaderText.FontFace = Font.new("rbxasset://fonts/families/GothamSSm.json", Enum.FontWeight.SemiBold, Enum.FontStyle.Normal)
HeaderText.TextColor3 = Color3.fromRGB(255, 255, 255)
HeaderText.BorderColor3 = Color3.fromRGB(0, 0, 0)
HeaderText.Text = "melatonin.win |" .. os.date("%B %d, %Y")
HeaderText.BackgroundTransparency = 1
HeaderText.Size = UDim2.new(1, 0, 1, 0)
HeaderText.BorderSizePixel = 0
HeaderText.TextSize = 14
HeaderText.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
HeaderText.Name = "HeaderText"
HeaderText.Parent = Header

local BottomBar = Instance.new("Frame")
BottomBar.Name = "BottomBar"
BottomBar.BackgroundTransparency = 1
BottomBar.Position = UDim2.new(0, 0, 0.936, 0)
BottomBar.BorderColor3 = Color3.fromRGB(0, 0, 0)
BottomBar.Size = UDim2.new(1, 0, 0.064, 0)
BottomBar.BorderSizePixel = 0
BottomBar.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
BottomBar.Parent = Main

local TabList = Instance.new("UIListLayout")
TabList.FillDirection = Enum.FillDirection.Horizontal
TabList.HorizontalFlex = Enum.UIFlexAlignment.Fill
TabList.Padding = UDim.new(0, 1)
TabList.SortOrder = Enum.SortOrder.LayoutOrder
TabList.Parent = BottomBar

local TabsContainer = Instance.new("Frame")
TabsContainer.Name = "TabsContainer"
TabsContainer.BackgroundTransparency = 1
TabsContainer.Position = UDim2.new(0.023, 0, 0.082, 0)
TabsContainer.BorderColor3 = Color3.fromRGB(0, 0, 0)
TabsContainer.Size = UDim2.new(0.956, 0, 0.836, 0)
TabsContainer.BorderSizePixel = 0
TabsContainer.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
TabsContainer.Parent = Main

local UILib = {
    Tabs = {},
    CurrentTab = nil,
    ThemeColor = Settings.ThemeColor,
    UIEnabled = false,
    Settings = Settings,
    Flags = {}
}

createSnowGuis()

local function startSnowEffect()
    if snowConnection then return end
    
    snowConnection = RunService.RenderStepped:Connect(function(dt)
        for _, snow in ipairs(snowflakes) do
            local frame = snow.frame
            local pos = frame.Position
            
            local newY = pos.Y.Scale + (snow.speed * dt / camera.ViewportSize.Y)
            local newX = pos.X.Scale + (snow.drift * dt / camera.ViewportSize.X)
            
            if newY > 1.1 then
                newY = -0.1
                newX = math.random()
            end
            
            frame.Position = UDim2.fromScale(newX, newY)
        end
    end)
end

local function stopSnowEffect()
    if snowConnection then
        snowConnection:Disconnect()
        snowConnection = nil
    end
end

local function updateThemeColor()
    for _, tab in pairs(UILib.Tabs) do
        for _, element in pairs(tab.Elements) do
            if element.Type == "Toggle" and element.Object and element.Object.Get and element.Object.Get() then
                local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
                local tween = TweenService:Create(element.ToggleFrame, tweenInfo, {BackgroundColor3 = UILib.ThemeColor})
                tween:Play()
            elseif element.Type == "Slider" then
                if element.Fill then
                    local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
                    local tween = TweenService:Create(element.Fill, tweenInfo, {BackgroundColor3 = UILib.ThemeColor})
                    tween:Play()
                end
            elseif element.Type == "Keybind" then
                if element.KeyButton and element.KeyButton.BackgroundColor3 == UILib.ThemeColor then
                    local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
                    local tween = TweenService:Create(element.KeyButton, tweenInfo, {BackgroundColor3 = UILib.ThemeColor})
                    tween:Play()
                end
            end
        end
    end
end

local function updateDarkBackground()
    if snowBackgroundGui then
        local snowBackground = snowBackgroundGui:FindFirstChild("Frame")
        if snowBackground then
            snowBackground.BackgroundTransparency = Settings.DarkBackground and 0.3 or 1
        end
    end
end

local function updateSnowEffect()
    if UILib.UIEnabled then
        if Settings.SnowEffect then
            startSnowEffect()
        else
            stopSnowEffect()
        end
    end
end

function UILib:ToggleUI()
    self.UIEnabled = not self.UIEnabled
    
    scrennnnnnngui.Enabled = self.UIEnabled
    if snowBackgroundGui then
        snowBackgroundGui.Enabled = self.UIEnabled and Settings.DarkBackground
    end
    if snowFlakesGui then
        snowFlakesGui.Enabled = self.UIEnabled and Settings.SnowEffect
    end
    
    if self.UIEnabled and Settings.SnowEffect then
        startSnowEffect()
    else
        stopSnowEffect()
    end
end

local toggleKeyConnection
local function setupKeybind()
    if toggleKeyConnection then
        toggleKeyConnection:Disconnect()
    end
    
    toggleKeyConnection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if input.KeyCode == Settings.ToggleKey and not gameProcessed then
            UILib:ToggleUI()
        end
    end)
end

setupKeybind()

function UILib:SetHeaderText(text)
    HeaderText.Text = text
end

function UILib:CreateTab(name)
    local tabButton = Instance.new("TextButton")
    tabButton.FontFace = Font.new("rbxasset://fonts/families/GothamSSm.json", Enum.FontWeight.Regular, Enum.FontStyle.Normal)
    tabButton.TextColor3 = Color3.fromRGB(154, 154, 154)
    tabButton.Text = name
    tabButton.BackgroundTransparency = 1
    tabButton.Size = UDim2.new(0, 0, 1, 0)
    tabButton.AutomaticSize = Enum.AutomaticSize.X
    tabButton.TextSize = 12
    tabButton.Parent = BottomBar
    
    local tabContent = Instance.new("Frame")
    tabContent.Name = name .. "Tab"
    tabContent.BackgroundTransparency = 1
    tabContent.Size = UDim2.new(1, 0, 1, 0)
    tabContent.Visible = false
    tabContent.Parent = TabsContainer
    
    local tabData = {
        Name = name,
        Button = tabButton,
        Content = tabContent,
        LeftSector = nil,
        RightSector = nil,
        Elements = {}
    }
    
    local Interface = Instance.new("Frame")
    Interface.Name = "Interface"
    Interface.BackgroundTransparency = 1
    Interface.Size = UDim2.new(1, 0, 1, 0)
    Interface.Parent = tabContent
    
    local LeftSector = Instance.new("ScrollingFrame")
    LeftSector.ScrollBarImageColor3 = Color3.fromRGB(0, 0, 0)
    LeftSector.Active = true
    LeftSector.AutomaticCanvasSize = Enum.AutomaticSize.Y
    LeftSector.ScrollBarThickness = 0
    LeftSector.BackgroundTransparency = 0.9
    LeftSector.Size = UDim2.new(0.5, 0, 1, 0)
    LeftSector.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    LeftSector.Parent = Interface
    
    local LeftList = Instance.new("UIListLayout")
    LeftList.Padding = UDim.new(0, 8)
    LeftList.SortOrder = Enum.SortOrder.LayoutOrder
    LeftList.Parent = LeftSector
    
    local RightSector = Instance.new("ScrollingFrame")
    RightSector.ScrollBarImageColor3 = Color3.fromRGB(0, 0, 0)
    RightSector.Active = true
    RightSector.AutomaticCanvasSize = Enum.AutomaticSize.Y
    RightSector.ScrollBarThickness = 0
    RightSector.BackgroundTransparency = 0.9
    RightSector.Position = UDim2.new(0.5, 0, 0, 0)
    RightSector.Size = UDim2.new(0.5, 0, 1, 0)
    RightSector.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    RightSector.Parent = Interface
    
    local RightList = Instance.new("UIListLayout")
    RightList.Padding = UDim.new(0, 8)
    RightList.SortOrder = Enum.SortOrder.LayoutOrder
    RightList.Parent = RightSector
    
    tabData.LeftSector = LeftSector
    tabData.RightSector = RightSector
    
    tabButton.MouseButton1Click:Connect(function()
        self:SwitchTab(name)
    end)
    
    table.insert(self.Tabs, tabData)
    
    if #self.Tabs == 1 then
        self:SwitchTab(name)
    end
    
    return tabData
end

function UILib:SwitchTab(tabName)
    for _, tab in pairs(self.Tabs) do
        tab.Content.Visible = false
        tab.Button.TextColor3 = Color3.fromRGB(154, 154, 154)
    end
    
    for _, tab in pairs(self.Tabs) do
        if tab.Name == tabName then
            tab.Content.Visible = true
            tab.Button.TextColor3 = Color3.fromRGB(255, 255, 255)
            self.CurrentTab = tab
            break
        end
    end
end

function UILib:CreateSection(parent, name)
    local section = Instance.new("Frame")
    section.LayoutOrder = #parent:GetChildren() + 1
    section.Name = name
    section.Size = UDim2.new(1, 0, 0, 0)
    section.BorderSizePixel = 0
    section.AutomaticSize = Enum.AutomaticSize.Y
    section.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    section.Parent = parent
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 4)
    UICorner.Parent = section
    
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.fromRGB(40, 40, 40)
    UIStroke.Parent = section
    
    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(1, 0, 0, 28)
    Frame.BorderSizePixel = 0
    Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Frame.Parent = section
    
    local UICorner2 = Instance.new("UICorner")
    UICorner2.CornerRadius = UDim.new(0, 4)
    UICorner2.Parent = Frame
    
    local TextLabel = Instance.new("TextLabel")
    TextLabel.FontFace = Font.new("rbxasset://fonts/families/GothamSSm.json", Enum.FontWeight.Medium, Enum.FontStyle.Normal)
    TextLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    TextLabel.Text = name
    TextLabel.BackgroundTransparency = 1
    TextLabel.Position = UDim2.new(0, 6, 0, 0)
    TextLabel.TextXAlignment = Enum.TextXAlignment.Left
    TextLabel.TextSize = 13
    TextLabel.Size = UDim2.new(1, -12, 1, 0)
    TextLabel.Parent = Frame
    
    local Frame2 = Instance.new("Frame")
    Frame2.BackgroundTransparency = 1
    Frame2.Position = UDim2.new(0, 0, 0, 32)
    Frame2.AutomaticSize = Enum.AutomaticSize.Y
    Frame2.Size = UDim2.new(1, 0, 0, 0)
    Frame2.Parent = section
    
    local UIListLayout = Instance.new("UIListLayout")
    UIListLayout.Padding = UDim.new(0, 6)
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    UIListLayout.Parent = Frame2
    
    local UIPadding = Instance.new("UIPadding")
    UIPadding.PaddingTop = UDim.new(0, 6)
    UIPadding.PaddingBottom = UDim.new(0, 6)
    UIPadding.PaddingRight = UDim.new(0, 8)
    UIPadding.PaddingLeft = UDim.new(0, 8)
    UIPadding.Parent = Frame2
    
    return Frame2
end

function UILib:CreateToggle(parent, name, default, callback)
    local toggle = Instance.new("Frame")
    toggle.Name = name
    toggle.Size = UDim2.new(1, 0, 0, 32)
    toggle.BorderSizePixel = 0
    toggle.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    toggle.Parent = parent
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 4)
    UICorner.Parent = toggle
    
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.fromRGB(45, 45, 45)
    UIStroke.Parent = toggle
    
    local TextLabel = Instance.new("TextLabel")
    TextLabel.FontFace = Font.new("rbxasset://fonts/families/GothamSSm.json", Enum.FontWeight.Regular, Enum.FontStyle.Normal)
    TextLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    TextLabel.Text = name
    TextLabel.BackgroundTransparency = 1
    TextLabel.Position = UDim2.new(0, 6, 0, 0)
    TextLabel.TextXAlignment = Enum.TextXAlignment.Left
    TextLabel.TextSize = 13
    TextLabel.Size = UDim2.new(0.7, -6, 1, 0)
    TextLabel.Parent = toggle
    
    local toggleFrame = Instance.new("Frame")
    toggleFrame.Position = UDim2.new(1, -28, 0.5, -11)
    toggleFrame.Size = UDim2.new(0, 22, 0, 22)
    toggleFrame.BorderSizePixel = 0
    toggleFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    toggleFrame.Parent = toggle
    
    local UICorner2 = Instance.new("UICorner")
    UICorner2.CornerRadius = UDim.new(0, 4)
    UICorner2.Parent = toggleFrame
    
    local toggleButton = Instance.new("TextButton")
    toggleButton.Text = ""
    toggleButton.BackgroundTransparency = 1
    toggleButton.Size = UDim2.new(1, 0, 1, 0)
    toggleButton.Parent = toggleFrame
    
    local toggleState = default or false
    
    local function updateToggle()
        local targetColor = toggleState and self.ThemeColor or Color3.fromRGB(45, 45, 45)
        local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween = TweenService:Create(toggleFrame, tweenInfo, {BackgroundColor3 = targetColor})
        tween:Play()
    end
    
    updateToggle()
    
    toggleButton.MouseButton1Click:Connect(function()
        toggleState = not toggleState
        updateToggle()
        if callback then
            callback(toggleState)
        end
    end)
    
    local toggleData = {
        Type = "Toggle",
        Object = {
            Set = function(value)
                toggleState = value
                updateToggle()
                if callback then
                    callback(toggleState)
                end
            end,
            Get = function()
                return toggleState
            end
        },
        ToggleFrame = toggleFrame
    }
    
    if self.CurrentTab then
        table.insert(self.CurrentTab.Elements, toggleData)
    end
    
    return toggleData.Object
end

function UILib:CreateSlider(parent, name, min, max, default, callback)
    local slider = Instance.new("Frame")
    slider.Name = name
    slider.Size = UDim2.new(1, 0, 0, 48)
    slider.BorderSizePixel = 0
    slider.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    slider.Parent = parent
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 4)
    UICorner.Parent = slider
    
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.fromRGB(45, 45, 45)
    UIStroke.Parent = slider
    
    local TextLabel = Instance.new("TextLabel")
    TextLabel.FontFace = Font.new("rbxasset://fonts/families/GothamSSm.json", Enum.FontWeight.Regular, Enum.FontStyle.Normal)
    TextLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    TextLabel.Text = name
    TextLabel.BackgroundTransparency = 1
    TextLabel.Position = UDim2.new(0, 6, 0, 4)
    TextLabel.TextXAlignment = Enum.TextXAlignment.Left
    TextLabel.TextSize = 13
    TextLabel.Size = UDim2.new(1, -12, 0, 20)
    TextLabel.Parent = slider
    
    local valueLabel = Instance.new("TextLabel")
    valueLabel.FontFace = Font.new("rbxasset://fonts/families/GothamSSm.json", Enum.FontWeight.Regular, Enum.FontStyle.Normal)
    valueLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    valueLabel.Text = tostring(default or min)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Position = UDim2.new(1, -46, 0, 4)
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.TextSize = 12
    valueLabel.Size = UDim2.new(0, 40, 0, 20)
    valueLabel.Parent = slider
    
    local track = Instance.new("Frame")
    track.Position = UDim2.new(0, 6, 1, -16)
    track.Size = UDim2.new(1, -12, 0, 4)
    track.BorderSizePixel = 0
    track.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    track.Parent = slider
    
    local UICorner2 = Instance.new("UICorner")
    UICorner2.CornerRadius = UDim.new(1, 0)
    UICorner2.Parent = track
    
    local fill = Instance.new("Frame")
    fill.Size = UDim2.new(0.25, 0, 1, 0)
    fill.BackgroundColor3 = self.ThemeColor
    fill.Parent = track
    
    local UICorner3 = Instance.new("UICorner")
    UICorner3.CornerRadius = UDim.new(1, 0)
    UICorner3.Parent = fill
    
    local thumb = Instance.new("TextButton")
    thumb.Size = UDim2.new(0, 12, 0, 12)
    thumb.Position = UDim2.new(0.25, -6, 0.5, -6)
    thumb.Text = ""
    thumb.BorderSizePixel = 0
    thumb.BackgroundColor3 = Color3.fromRGB(220, 220, 220)
    thumb.Parent = track
    
    local UICorner4 = Instance.new("UICorner")
    UICorner4.CornerRadius = UDim.new(1, 0)
    UICorner4.Parent = thumb
    
    local currentValue = default or min
    local isDragging = false
    
    local function updateSlider(value)
        currentValue = math.clamp(value, min, max)
        local percent = (currentValue - min) / (max - min)
        
        local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local fillTween = TweenService:Create(fill, tweenInfo, {Size = UDim2.new(percent, 0, 1, 0)})
        local thumbTween = TweenService:Create(thumb, tweenInfo, {Position = UDim2.new(percent, -6, 0.5, -6)})
        
        fillTween:Play()
        thumbTween:Play()
        valueLabel.Text = tostring(math.floor(currentValue))
        if callback then
            callback(currentValue)
        end
    end
    
    updateSlider(currentValue)
    
    thumb.MouseButton1Down:Connect(function()
        isDragging = true
    end)
    
    game:GetService("UserInputService").InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDragging = false
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local mousePos = game:GetService("Players").LocalPlayer:GetMouse()
            local relativeX = (mousePos.X - track.AbsolutePosition.X) / track.AbsoluteSize.X
            local percent = math.clamp(relativeX, 0, 1)
            local value = min + (max - min) * percent
            updateSlider(value)
        end
    end)
    
    local sliderData = {
        Type = "Slider",
        Object = {
            Set = function(value)
                updateSlider(value)
            end,
            Get = function()
                return currentValue
            end
        },
        Fill = fill
    }
    
    if self.CurrentTab then
        table.insert(self.CurrentTab.Elements, sliderData)
    end
    
    return sliderData.Object
end

function UILib:CreateColorPicker(parent, name, defaultColor, flag, callback)
    local default = defaultColor or Color3.fromRGB(255, 255, 255)
    local colorH, colorS, colorV = default:ToHSV()
    local currentColor = default
    
    local PickerFrame = Instance.new("Frame")
    PickerFrame.Size = UDim2.new(1, 0, 0, 32)
    PickerFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    PickerFrame.BorderSizePixel = 0
    PickerFrame.Parent = parent
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 4)
    UICorner.Parent = PickerFrame
    
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.fromRGB(45, 45, 45)
    UIStroke.Parent = PickerFrame
    
    local TextLabel = Instance.new("TextLabel")
    TextLabel.FontFace = Font.new("rbxasset://fonts/families/GothamSSm.json", Enum.FontWeight.Regular, Enum.FontStyle.Normal)
    TextLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    TextLabel.Text = name
    TextLabel.BackgroundTransparency = 1
    TextLabel.Position = UDim2.new(0, 6, 0, 0)
    TextLabel.TextXAlignment = Enum.TextXAlignment.Left
    TextLabel.TextSize = 13
    TextLabel.Size = UDim2.new(0.7, -6, 1, 0)
    TextLabel.Parent = PickerFrame
    
    local ColorBtn = Instance.new("TextButton")
    ColorBtn.Position = UDim2.new(1, -28, 0.5, -11)
    ColorBtn.Size = UDim2.new(0, 22, 0, 22)
    ColorBtn.BackgroundColor3 = currentColor
    ColorBtn.BorderColor3 = Color3.fromRGB(45, 45, 45)
    ColorBtn.BorderSizePixel = 1
    ColorBtn.Text = ""
    ColorBtn.Parent = PickerFrame
    
    local CP_Container = Instance.new("Frame")
    CP_Container.Size = UDim2.new(1, 0, 0, 130)
    CP_Container.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    CP_Container.BorderColor3 = Color3.fromRGB(45, 45, 45)
    CP_Container.BorderSizePixel = 1
    CP_Container.Visible = false
    CP_Container.ClipsDescendants = true
    CP_Container.Parent = parent
    CP_Container.ZIndex = 5 
    
    local UICorner2 = Instance.new("UICorner")
    UICorner2.CornerRadius = UDim.new(0, 4)
    UICorner2.Parent = CP_Container
    
    local SV_Map = Instance.new("ImageButton")
    SV_Map.Size = UDim2.new(0, 100, 0, 100)
    SV_Map.Position = UDim2.new(0, 10, 0, 10)
    SV_Map.BackgroundColor3 = Color3.fromHSV(colorH, 1, 1)
    SV_Map.Image = "rbxassetid://4155801252"
    SV_Map.BorderSizePixel = 0
    SV_Map.AutoButtonColor = false
    SV_Map.Parent = CP_Container
    SV_Map.ZIndex = 6
    
    local SV_Cursor = Instance.new("Frame")
    SV_Cursor.Size = UDim2.new(0, 4, 0, 4)
    SV_Cursor.AnchorPoint = Vector2.new(0.5, 0.5)
    SV_Cursor.BackgroundColor3 = Color3.new(1, 1, 1)
    SV_Cursor.BorderColor3 = Color3.new(0, 0, 0)
    SV_Cursor.Parent = SV_Map
    SV_Cursor.ZIndex = 7
    SV_Cursor.Position = UDim2.new(colorS, 0, 1 - colorV, 0)

    local Hue_Bar = Instance.new("ImageButton")
    Hue_Bar.Size = UDim2.new(0, 20, 0, 100)
    Hue_Bar.Position = UDim2.new(0, 120, 0, 10)
    Hue_Bar.BackgroundColor3 = Color3.new(1, 1, 1)
    Hue_Bar.BorderSizePixel = 0
    Hue_Bar.AutoButtonColor = false
    Hue_Bar.Parent = CP_Container
    Hue_Bar.ZIndex = 6
    
    local UIGradient = Instance.new("UIGradient")
    UIGradient.Rotation = 90
    UIGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)), 
        ColorSequenceKeypoint.new(0.167, Color3.fromRGB(255, 255, 0)), 
        ColorSequenceKeypoint.new(0.333, Color3.fromRGB(0, 255, 0)), 
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)), 
        ColorSequenceKeypoint.new(0.667, Color3.fromRGB(0, 0, 255)), 
        ColorSequenceKeypoint.new(0.833, Color3.fromRGB(255, 0, 255)), 
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
    }
    UIGradient.Parent = Hue_Bar
    
    local Hue_Cursor = Instance.new("Frame")
    Hue_Cursor.Size = UDim2.new(1, 0, 0, 2)
    Hue_Cursor.BackgroundColor3 = Color3.new(1, 1, 1)
    Hue_Cursor.BorderColor3 = Color3.new(0, 0, 0)
    Hue_Cursor.Parent = Hue_Bar
    Hue_Cursor.ZIndex = 7
    Hue_Cursor.Position = UDim2.new(0, 0, colorH, 0)
    
    local function UpdateColorPicker()
        currentColor = Color3.fromHSV(colorH, colorS, colorV)
        
        local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween = TweenService:Create(ColorBtn, tweenInfo, {BackgroundColor3 = currentColor})
        tween:Play()
        
        SV_Map.BackgroundColor3 = Color3.fromHSV(colorH, 1, 1)
        
        if flag then 
            UILib.Flags[flag] = currentColor 
        end
        
        pcall(callback, currentColor)
    end
    
    local draggingSV, draggingHue = false, false
    
    local function UpdateSV(input)
        local rX = math.clamp(input.Position.X - SV_Map.AbsolutePosition.X, 0, SV_Map.AbsoluteSize.X)
        local rY = math.clamp(input.Position.Y - SV_Map.AbsolutePosition.Y, 0, SV_Map.AbsoluteSize.Y)
        
        colorS = rX / SV_Map.AbsoluteSize.X
        colorV = 1 - (rY / SV_Map.AbsoluteSize.Y)
        
        SV_Cursor.Position = UDim2.new(colorS, 0, 1 - colorV, 0)
        UpdateColorPicker()
    end
    
    local function UpdateHue(input)
        local rY = math.clamp(input.Position.Y - Hue_Bar.AbsolutePosition.Y, 0, Hue_Bar.AbsoluteSize.Y)
        colorH = rY / Hue_Bar.AbsoluteSize.Y
        
        Hue_Cursor.Position = UDim2.new(0, 0, colorH, 0)
        UpdateColorPicker()
    end

    SV_Map.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            draggingSV = true
            UpdateSV(input)
        end
    end)
    
    Hue_Bar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            draggingHue = true
            UpdateHue(input)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if draggingSV and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            UpdateSV(input)
        elseif draggingHue and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            UpdateHue(input)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            draggingSV = false
            draggingHue = false
        end
    end)
    
    local open = false
    ColorBtn.MouseButton1Click:Connect(function()
        open = not open
        CP_Container.Visible = open
    end)
    
    if flag then 
        UILib.Flags[flag] = default 
    end
    
    local ColorObj = {}
    
    function ColorObj:Set(col)
        if typeof(col) == "table" then 
            col = Color3.new(col.R, col.G, col.B) 
        end
        colorH, colorS, colorV = col:ToHSV()
        currentColor = col
        SV_Cursor.Position = UDim2.new(colorS, 0, 1 - colorV, 0)
        Hue_Cursor.Position = UDim2.new(0, 0, colorH, 0)
        UpdateColorPicker()
    end
    
    function ColorObj:Get()
        return currentColor
    end
    
    return ColorObj
end

function UILib:CreateTextBox(parent, name, placeholder, default, callback)
    local textBoxFrame = Instance.new("Frame")
    textBoxFrame.Name = name
    textBoxFrame.Size = UDim2.new(1, 0, 0, 32)
    textBoxFrame.BorderSizePixel = 0
    textBoxFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    textBoxFrame.Parent = parent
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 4)
    UICorner.Parent = textBoxFrame
    
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.fromRGB(45, 45, 45)
    UIStroke.Parent = textBoxFrame
    
    local TextLabel = Instance.new("TextLabel")
    TextLabel.FontFace = Font.new("rbxasset://fonts/families/GothamSSm.json", Enum.FontWeight.Regular, Enum.FontStyle.Normal)
    TextLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    TextLabel.Text = name
    TextLabel.BackgroundTransparency = 1
    TextLabel.Position = UDim2.new(0, 6, 0, 0)
    TextLabel.TextXAlignment = Enum.TextXAlignment.Left
    TextLabel.TextSize = 13
    TextLabel.Size = UDim2.new(0.7, -6, 1, 0)
    TextLabel.Parent = textBoxFrame
    
    local textBox = Instance.new("TextBox")
    textBox.Position = UDim2.new(1, -100, 0.5, -10)
    textBox.Size = UDim2.new(0, 90, 0, 20)
    textBox.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    textBox.BorderColor3 = Color3.fromRGB(60, 60, 60)
    textBox.BorderSizePixel = 1
    textBox.TextColor3 = Color3.fromRGB(220, 220, 220)
    textBox.FontFace = Font.new("rbxasset://fonts/families/GothamSSm.json", Enum.FontWeight.Regular, Enum.FontStyle.Normal)
    textBox.TextSize = 12
    textBox.PlaceholderText = placeholder or ""
    textBox.Text = default or ""
    textBox.Parent = textBoxFrame
    
    local UICorner2 = Instance.new("UICorner")
    UICorner2.CornerRadius = UDim.new(0, 4)
    UICorner2.Parent = textBox
    
    local function onFocus()
        local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween = TweenService:Create(textBox, tweenInfo, {
            BackgroundColor3 = Color3.fromRGB(55, 55, 55),
            BorderColor3 = self.ThemeColor
        })
        tween:Play()
    end
    
    local function onFocusLost()
        local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween = TweenService:Create(textBox, tweenInfo, {
            BackgroundColor3 = Color3.fromRGB(45, 45, 45),
            BorderColor3 = Color3.fromRGB(60, 60, 60)
        })
        tween:Play()
        
        if callback then
            callback(textBox.Text)
        end
    end
    
    textBox.Focused:Connect(onFocus)
    textBox.FocusLost:Connect(onFocusLost)
    
    return {
        Set = function(text)
            textBox.Text = text
            if callback then
                callback(text)
            end
        end,
        Get = function()
            return textBox.Text
        end
    }
end

function UILib:CreateKeybind(parent, name, defaultKey, callback)
    local keybind = Instance.new("Frame")
    keybind.Name = name
    keybind.Size = UDim2.new(1, 0, 0, 32)
    keybind.BorderSizePixel = 0
    keybind.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    keybind.Parent = parent
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 4)
    UICorner.Parent = keybind
    
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.fromRGB(45, 45, 45)
    UIStroke.Parent = keybind
    
    local TextLabel = Instance.new("TextLabel")
    TextLabel.FontFace = Font.new("rbxasset://fonts/families/GothamSSm.json", Enum.FontWeight.Regular, Enum.FontStyle.Normal)
    TextLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
    TextLabel.Text = name
    TextLabel.BackgroundTransparency = 1
    TextLabel.Position = UDim2.new(0, 6, 0, 0)
    TextLabel.TextXAlignment = Enum.TextXAlignment.Left
    TextLabel.TextSize = 13
    TextLabel.Size = UDim2.new(0.7, -6, 1, 0)
    TextLabel.Parent = keybind
    
    local buttonContainer = Instance.new("Frame")
    buttonContainer.Name = "ButtonContainer"
    buttonContainer.BackgroundTransparency = 1
    buttonContainer.Position = UDim2.new(1, 0, 0.5, 0)
    buttonContainer.AnchorPoint = Vector2.new(1, 0.5)
    buttonContainer.Size = UDim2.new(0, 0, 0, 22)
    buttonContainer.AutomaticSize = Enum.AutomaticSize.X
    buttonContainer.Parent = keybind
    
    local keyButton = Instance.new("TextButton")
    keyButton.Name = "KeyButton"
    keyButton.Size = UDim2.new(0, 0, 1, 0)
    keyButton.AutomaticSize = Enum.AutomaticSize.X
    keyButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    keyButton.BorderSizePixel = 0
    keyButton.Text = tostring(defaultKey.Name):gsub("Enum.KeyCode.", "")
    keyButton.TextColor3 = Color3.fromRGB(220, 220, 220)
    keyButton.TextSize = 11
    keyButton.FontFace = Font.new("rbxasset://fonts/families/GothamSSm.json", Enum.FontWeight.Regular, Enum.FontStyle.Normal)
    keyButton.Parent = buttonContainer
    
    local UICorner2 = Instance.new("UICorner")
    UICorner2.CornerRadius = UDim.new(0, 4)
    UICorner2.Parent = keyButton
    
    local padding = Instance.new("UIPadding")
    padding.PaddingLeft = UDim.new(0, 8)
    padding.PaddingRight = UDim.new(0, 8)
    padding.Parent = keyButton
    
    local currentKey = defaultKey
    local listening = false
    
    local function updateKeybind()
        local keyName = tostring(currentKey.Name):gsub("Enum.KeyCode.", "")
        keyButton.Text = keyName
        if callback then
            callback(currentKey)
        end
    end
    
    updateKeybind()
    
    keyButton.MouseButton1Click:Connect(function()
        listening = true
        keyButton.Text = "..."
        
        local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween = TweenService:Create(keyButton, tweenInfo, {BackgroundColor3 = self.ThemeColor})
        tween:Play()
        
        local connection
        connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
            if not gameProcessed and input.UserInputType == Enum.UserInputType.Keyboard then
                currentKey = input.KeyCode
                listening = false
                
                local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
                local tween = TweenService:Create(keyButton, tweenInfo, {BackgroundColor3 = Color3.fromRGB(45, 45, 45)})
                tween:Play()
                
                updateKeybind()
                connection:Disconnect()
            end
        end)
    end)
    
    local keybindData = {
        Type = "Keybind",
        Object = {
            Set = function(key)
                currentKey = key
                updateKeybind()
            end,
            Get = function()
                return currentKey
            end
        },
        KeyButton = keyButton
    }
    
    if self.CurrentTab then
        table.insert(self.CurrentTab.Elements, keybindData)
    end
    
    return keybindData.Object
end

local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

Header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = Main.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Header.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input == dragInput then
        update(input)
    end
end)

return UILib
